# [Анализ данных Яндекс.Музыки](https://lyrics-analysis.vercel.app/)

## Структура проекта

* ```data_parser``` - модуль сбора данных из Yandex.Music API. Парсит данные и загружает их в MongoDB. Допускается создание нескольких экзепляров (на уровне жанров).
* ```data_loader``` - модуль загрузки данных из MongoDB в очередь RabbitMQ для последующего их преобразования.
* ```data_transforms``` - модуль преобразования данных: получает сырые данные из очереди, трансформирует их и выгружает в MongoDB. Допускается создание нескольких экземпляров.
* ```data_aggregation``` - модуль агрегации трансформированных данных. Выполняет агрегацию с помощью MongoDB aggregation pipelines и сохраняет результат как JSON документ. 
* ```data_visualization``` - модуль визуализации данных: Next.js приложение с базовыми компонентами, визуализируещее полученный JSON документ из модуля ```data_aggregation```.

## Установка и запуск

> **Требования для установки и запуска**: 
> * docker
> * docker-compose

* Клонировать репозиторий: ```git clone https://github.com/dumaevrinat/lyrics_analysis.git```.
* Перейти в директорию проекта: ```cd lyrics_analysis```.
* Запустить сервисы MongoDB и RabbitMQ: 
  * ```docker-compose up -d mongodb```
  * ```docker-compose up -d rabbitmq```
* Запустить один или несколько модулей сборки данных с помощью команды ```docker-compose run -d data_parser``` с 3 параметрами:
  * Название метатэга, из которого нужно собрать данные, например: ```'rusrap'```, ```'rusestrada'```, ```'rusrock'```.
  * Тип данных, которые нужно собрать. Возможны следующие значения: ```'artists'```, ```'tracks'```, ```'artists_info'```.
  * Максимальное количество одновременно запланированных задач. При большом числе (>25) задачи могут уходить в Timeout.
* Дождаться выполнения сбора данных в mongodb и запустить один или несколько модулей трансформации: 
<br/>```docker-compose run -d data_transforms```.
* После запуска модулей трансформации запустить модуль выгрузки данных и дождаться их выполнения: 
<br/>```docker-compose run -d data_loader```.
* Запустить модуль агрегации данных: ```docker-compose run -d data_aggregation 'data.json'```.
* Cкопировать полученный json файл в модуль визуализации, указав id контейнера агрегации данных: 
<br/>```docker cp {ID КОНТЕЙНЕРА АГРЕГАЦИИ}:data.json data_visualization/data```.
* Запустить модуль визуализации: ```docker-compose up -d data_visualization```.

Основные переменные окружения доступны в файле ```.env```. Веб-приложение доступно по адресу http://localhost:3000. Для управления и мониторинга узлов и кластеров RabbitMQ перейти на http://localhost:15672.
